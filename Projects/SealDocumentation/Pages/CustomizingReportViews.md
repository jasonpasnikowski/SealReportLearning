# Customizing Report Views and Templates in Seal Report

## 1. Introduction

Seal Report offers a flexible way to present data through its report views, which are rendered using Razor-based templates. Customizing these views and templates allows you to tailor the appearance, layout, and even the behavior of your reports to meet specific needs. This document explains the structure of these templates and how to modify them.

## 2. Template Overview

Report rendering in Seal Report is primarily driven by a set of `.cshtml` template files. These templates can be customized at various levels.

*   **Standard Templates Location**: The default set of templates is located in your Seal Report Repository, typically under the `Repository/Views` subfolder.

### Main View Templates

These are the top-level templates that define the overall structure of a report or a model within a report.

*   **`Report.cshtml`**: This is the master template for the entire report. It usually handles the overall HTML structure (header, body, footer) and includes other partial views for specific sections like restrictions, information, and the actual report content (which is often a model view).
    *   **Role**: Defines the global layout of the report page.
    *   **Interaction**: Includes `Report.iRestrictions.partial.cshtml` for input controls, `Report.iInformation.partial.cshtml` for report messages, and typically iterates through `ReportView` objects, often rendering a `Model.cshtml` for each.

*   **`Model.cshtml`**: This template is used to render a specific data model within a report. It's responsible for displaying the data itself, which could be in tables, charts, or other formats. It often includes partials for menus, data tables, and pagination.
    *   **Role**: Defines how a data model (data, charts, tables) is presented.
    *   **Interaction**: Often includes `Model.iMenu.partial.cshtml` for navigation/filtering options based on the model's data, `Model.iPages.partial.cshtml` for pagination, and `Model.iSummaryTable.partial.cshtml` for summary data. It also renders the primary view of the data (e.g., a Page Table or Data Table view).

### Key Partial Templates

Partial templates are smaller, reusable pieces of Razor code that are included within main templates or other partials. They handle specific sections or functionalities.

*   **`Report.iRestrictions.partial.cshtml`**:
    *   **Responsibility**: Renders the input controls (like dropdowns, date pickers, text boxes) for report restrictions that allow users to filter the data.
    *   **Included in**: `Report.cshtml`.

*   **`Restrictions.iShared.partial.cshtml`**:
    *   **Responsibility**: Often contains shared logic or layout for individual restriction controls. It's used by `Report.iRestrictions.partial.cshtml` to render each restriction.
    *   **Included in**: `Report.iRestrictions.partial.cshtml` (typically within a loop for each restriction).

*   **`Model.iMenu.partial.cshtml`**:
    *   **Responsibility**: Renders a menu, often used for filtering or navigating data within a model. This is the template frequently responsible for the "button per record" behavior if data is structured in a certain way (e.g., pivoted to create page navigators).
    *   **Included in**: `Model.cshtml`.

*   **`Model.iPages.partial.cshtml`**:
    *   **Responsibility**: Handles pagination controls if the data model is split into multiple pages.
    *   **Included in**: `Model.cshtml`.

*   **`Model.iSummaryTable.partial.cshtml`**:
    *   **Responsibility**: Displays a summary of the data, often before the main data table.
    *   **Included in**: `Model.cshtml`.

### How They Interact

The rendering process typically starts with `Report.cshtml`.
1.  `Report.cshtml` sets up the main page structure.
2.  It includes `Report.iRestrictions.partial.cshtml` to display any defined report restrictions.
3.  It then iterates through the `ReportView` instances defined in the report.
4.  For each `ReportView` that uses `Model.cshtml` (either directly or as its configured template), the `Model.cshtml` template is rendered.
5.  `Model.cshtml` in turn includes its own partials:
    *   `Model.iMenu.partial.cshtml` (if configured via `model_menu_type` parameter).
    *   The main data view (e.g., Page Table, Data Table).
    *   `Model.iPages.partial.cshtml` for pagination.
    *   `Model.iSummaryTable.partial.cshtml` for summaries.

## 3. Addressing the 'Button Per Record' Issue (Filter-like Menu)

A common customization query relates to a menu that appears with "buttons" for each distinct value of a certain field, often resembling a filter. This is usually generated by the `Model.iMenu.partial.cshtml` template.

This behavior is triggered when a `ReportView` using the `Model.cshtml` template has its `model_menu_type` parameter set to a value other than `none` (e.g., `top`, `left`, `right`). This parameter is found in the Report Designer when you select the specific `ReportView` that uses `Model.cshtml`.

The menu is typically populated based on the `reportModel.Pages` collection or elements within `reportModel.SummaryTable` if the data has been pivoted or structured to create distinct page sections or summary groups. If a report element is set to "Page" in the pivot table, it contributes to this menu structure.

### Solutions:

*   **To remove the menu entirely for a specific `ReportView`**:
    1.  In the Report Designer, select the `ReportView` that is rendering the `Model.cshtml` template (this might be a view named "Model" or similar, check its "Template Name" property).
    2.  In the "Parameters" property grid for that view, find the `model_menu_type` parameter.
    3.  Set its value to `none`.
    4.  Save the report. This will prevent `Model.iMenu.partial.cshtml` from being rendered for that specific view.

*   **To alter menu content (Data Modeling Approach)**:
    *   The content of this menu is fundamentally driven by your report's data model and how elements are configured in the Pivot Table (e.g., elements set to "Page" or "Row" with specific options).
    *   If you want to change what appears in the menu, you'll likely need to adjust your `ReportModel` in the Report Designer:
        *   Review elements in your model that are set to `PivotPosition = Page`. These directly create entries in `reportModel.Pages`.
        *   Review how your data is aggregated and grouped, as this can influence `reportModel.SummaryTable`.
    *   This is a deeper topic related to data modeling and pivoting within Seal Report rather than just template customization.

*   **To remove the menu via a custom `Model.cshtml` template**:
    1.  Enable `UseCustomTemplate` for the `ReportView` using `Model.cshtml` (see section 4).
    2.  In the custom template text for `Model.cshtml`, find and remove or comment out the line that includes the menu partial:
        ```html
        @* Remove or comment out this line to disable the menu *@
        @* @Include(view.GetPartialTemplateKey("Model.iMenu", view), view) *@
        ```
        Or, for conditional rendering based on a new custom parameter you define (e.g., `show_model_menu`):
        ```html
        @if (view.GetParameter("show_model_menu") != null && view.GetParameter("show_model_menu").ToLower() == "true")
        {
            @Include(view.GetPartialTemplateKey("Model.iMenu", view), view)
        }
        ```
        You would then add a parameter named `show_model_menu` to your ReportView in the designer and set it to `true` or `false`.

## 4. Working with Custom Templates

Seal Report allows you to embed customized versions of templates directly into your report definition (`.srex`) file.

### Enabling Custom Templates:

*   **For a Main View Template (e.g., `Model.cshtml`, `Report.cshtml`)**:
    1.  In the Report Designer, select the `ReportView` for which you want to customize the template (e.g., the "Model" view or the root "View" for `Report.cshtml`).
    2.  In the "Properties" panel for that `ReportView`, find the `Template Name` property. It will show the current template being used (e.g., `Model` or `Report`).
    3.  Set the `Use Custom Template` property (or `UseCustomTemplate`) to `True`.
    4.  The `Custom Template` property (or `CustomTemplate`) will become editable. You can paste or write your modified Razor code here. Initially, it's good practice to copy the content of the standard template from the file system (`Repository/Views/<TemplateName>.cshtml`) as a starting point.

*   **For a Partial Template (e.g., `Model.iMenu.partial.cshtml`)**:
    1.  Select the `ReportView` that includes the partial template you want to customize (e.g., the "Model" view if you're customizing `Model.iMenu.partial.cshtml`).
    2.  Find the `Partial Templates Configuration` property (or `PartialTemplatesConfiguration`) in the "Properties" panel. Click the ellipsis (...) button to open the editor.
    3.  In the editor, you'll see a list of partial templates used by the main template of the selected `ReportView`.
    4.  Select the partial template you wish to customize (e.g., `Model.iMenu`).
    5.  Check the `Use Custom` box for that partial.
    6.  The `Text` field below will become active, allowing you to input your custom Razor code for that partial. Again, copy the original from `Repository/Views/Partials/<PartialName>.cshtml` if you need a starting point.

### Storage of Custom Templates in `.srex` Files:

When you use custom templates, their Razor code is stored directly within the XML structure of the `.srex` report file.

*   **For a main view template (e.g., `ReportView` using a custom `Model.cshtml`)**:
    The custom code is stored within the `<CustomTemplate>` tag of the corresponding `<ReportView>` element.
    ```xml
    <ReportView>
      <GUID>...</GUID>
      <Name>model</Name>
      <TemplateName>Model</TemplateName>
      <UseCustomTemplate>true</UseCustomTemplate>
      <CustomTemplate>
        <![CDATA[
        @* Your custom Model.cshtml Razor code here *@
        <h1>My Custom Model Title</h1>
        @Include(view.GetPartialTemplateKey("Model.iPages", view), view)
        ]]>
      </CustomTemplate>
      ...
    </ReportView>
    ```

*   **For a partial template**:
    Custom partial template code is stored within the `<PartialTemplates>` collection of the parent `ReportView`. Each custom partial has a `ReportViewPartialTemplate` entry.
    ```xml
    <ReportView>
      <GUID>...</GUID>
      <Name>model</Name>
      <TemplateName>Model</TemplateName>
      <PartialTemplates>
        <ReportViewPartialTemplate>
          <Name>Model.iMenu</Name>
          <UseCustom>true</UseCustom>
          <Text>
            <![CDATA[
            @* Custom Model.iMenu.partial.cshtml code *@
            <div class="custom-menu">
                <p>My Custom Menu Items Here</p>
            </div>
            ]]>
          </Text>
        </ReportViewPartialTemplate>
      </PartialTemplates>
      ...
    </ReportView>
    ```

### Fallback Behavior:

*   If `UseCustomTemplate` for a main view is set to `true`, but the `<CustomTemplate>` text is empty or missing, Seal Report will fall back to using the standard template file from the `Repository/Views` folder (e.g., `Model.cshtml`).
*   Similarly, if `UseCustom` for a partial template in the `PartialTemplatesConfiguration` is `true`, but its `<Text>` is empty, the system will use the standard partial template file (e.g., `Repository/Views/Partials/Model.iMenu.cshtml`).
    *Note: The exact path for partials might be `Repository/Views/Partials/` or directly in `Repository/Views/` depending on Seal Report version and specific template. Standard partials are often in `Repository/Views/` alongside main templates, and their names might be like `Report.iRestrictions.partial.cshtml`.*

### Basic Customization Example: Removing a Partial Include

Let's say you want to remove the standard menu from your `Model.cshtml` view without affecting other reports or using the `model_menu_type` parameter.

1.  In Report Designer, select the `ReportView` that uses the `Model` template.
2.  Set `Use Custom Template` to `True`.
3.  Copy the content of the standard `Repository/Views/Model.cshtml` into the `Custom Template` editor.
4.  Find the line that includes the menu partial:
    ```html
    @Include(view.GetPartialTemplateKey("Model.iMenu", view), view)
    ```
5.  Comment it out or delete it:
    ```html
    @* @Include(view.GetPartialTemplateKey("Model.iMenu", view), view) *@
    ```
6.  Save the report. Now, this specific `ReportView` will use your modified `Model.cshtml` which no longer includes the menu.

## 5. Locating Standard Templates

As mentioned, the standard, file-based Razor templates (`.cshtml`) are located in your Seal Report installation's repository folder.
*   **Typical Path**: `[Your Seal Repository Path]/Repository/Views/`
*   Partials might be in a subfolder like `[Your Seal Repository Path]/Repository/Views/Partials/` or directly within the `Views` folder, often with a naming convention like `MainTemplateName.iSpecificSection.partial.cshtml` (e.g., `Model.iMenu.partial.cshtml`).

Refer to these files to understand the default structure and to get a base for your customizations.
